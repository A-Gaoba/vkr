import{r as h,b as p,A as f,j as e,f as g}from"./index-B_5xIYw0.js";import{u as b,P as j}from"./usePagination-Bu73MaEA.js";const N=()=>{const[r,c]=h.useState([]),[l,a]=h.useState([]),[t,d]=h.useState(!0);return h.useEffect(()=>{(async()=>{try{const[o,n]=await Promise.all([p.get(`${f}/students`),p.get(`${f}/classes`)]);c(o.data),a(n.data),d(!1)}catch(o){console.error("Error fetching data:",o),d(!1)}})()},[]),{students:r,classes:l,loading:t}},x=({label:r,type:c,name:l,value:a,onChange:t,options:d,className:i,optionKey:o="id",optionLabel:n})=>e.jsx("div",{className:i,children:e.jsxs("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:[r," ",e.jsx("span",{className:"text-black",children:"*"}),":",c!=="select"?e.jsx("input",{type:c,name:l,value:a,onChange:t,required:!0,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"}):e.jsxs("select",{name:l,value:a,onChange:t,required:!0,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",children:[e.jsx("option",{value:"",children:"Select"}),d&&d.map(s=>e.jsx("option",{value:s[o],children:n?s[n]:s.name||`${s.firstName} ${s.lastName}`||`Level ${s.level}`},s[o]))]})]})}),y=({onSuccess:r})=>{const{students:c,classes:l,loading:a}=N(),[t,d]=h.useState({studentId:"",classId:"",date:"",status:"Present"}),i=n=>{const{name:s,value:u}=n.target;d(m=>({...m,[s]:u}))},o=async n=>{n.preventDefault();try{await p.post(`${f}/attendances`,{...t,studentId:parseInt(t.studentId,10),classId:parseInt(t.classId,10)}),alert("Attendance record added successfully!"),r()}catch(s){console.error("Error submitting form:",s),alert("Failed to add attendance record. Please check the console for more details.")}};return a?e.jsx(g,{}):e.jsxs("form",{onSubmit:o,className:"max-w-4xl mx-auto p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(x,{label:"Student",type:"select",name:"studentId",value:t.studentId,onChange:i,options:c,optionKey:"id",optionLabel:"firstName",className:"col-span-1"}),e.jsx(x,{label:"Class",type:"select",name:"classId",value:t.classId,onChange:i,options:l,optionKey:"id",optionLabel:"name",className:"col-span-1"}),e.jsx(x,{label:"Date",type:"date",name:"date",value:t.date,onChange:i,className:"col-span-1"}),e.jsx(x,{label:"Status",type:"select",name:"status",value:t.status,onChange:i,options:[{id:"Present",name:"Present"},{id:"Absent",name:"Absent"}],optionKey:"id",optionLabel:"name",className:"col-span-1"}),e.jsx("div",{className:"col-span-full",children:e.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full",children:"Add Attendance"})})]})},S=()=>{const[r,c]=h.useState([]),[l,a]=h.useState(!0),t=10;h.useEffect(()=>{(async()=>{try{const m=await p.get(`${f}/attendances`);c(m.data),a(!1)}catch(m){console.error("Error fetching attendances:",m),a(!1)}})()},[]);const{currentPage:d,setCurrentPage:i,totalPages:o,paginatedItemsIndex:n}=b(r.length,t),s=r.slice(n.startIndex,n.endIndex);return l?e.jsx(g,{}):e.jsxs("div",{children:[e.jsxs("table",{className:"mt-8 w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-1 text-center",children:"No"}),e.jsx("th",{className:"border p-1 text-center",children:"Student"}),e.jsx("th",{className:"border p-1 text-center",children:"Class"}),e.jsx("th",{className:"border p-1 text-center",children:"Date"}),e.jsx("th",{className:"border p-1 text-center",children:"Status"})]})}),e.jsx("tbody",{children:s.map((u,m)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-1 text-center",children:m+1+(d-1)*t}),e.jsx("td",{className:"border p-1 text-center",children:`${u.student.firstName} ${u.student.lastName}`}),e.jsx("td",{className:"border p-1 text-center",children:u.class.name}),e.jsx("td",{className:"border p-1 text-center",children:new Date(u.date).toLocaleDateString()}),e.jsx("td",{className:"border p-1 text-center",children:u.status})]},u.id))})]}),e.jsx(j,{totalPages:o,currentPage:d,onPageChange:i})]})},w=()=>{const[r,c]=h.useState(!1),l=()=>{c(a=>!a)};return e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Attendance Management"}),e.jsx(y,{onSuccess:l}),e.jsx(S,{},r?"refresh-true":"refresh-false")]})};export{w as default};
